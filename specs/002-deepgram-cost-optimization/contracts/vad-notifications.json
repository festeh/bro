{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "VAD Notification Messages",
  "description": "JSON schemas for messages sent via lk.vad_status LiveKit data topic",

  "definitions": {
    "turn_warning": {
      "type": "object",
      "description": "Sent when turn is approaching duration limit (at 55 seconds)",
      "required": ["type", "turn_id", "timestamp", "remaining_seconds"],
      "properties": {
        "type": {
          "const": "turn_warning"
        },
        "turn_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for the current turn"
        },
        "timestamp": {
          "type": "number",
          "description": "Unix timestamp when notification was generated"
        },
        "remaining_seconds": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10,
          "description": "Seconds remaining before turn termination"
        }
      },
      "additionalProperties": false
    },

    "turn_terminated": {
      "type": "object",
      "description": "Sent when turn is forcibly ended due to duration limit",
      "required": ["type", "turn_id", "timestamp", "reason", "final_duration"],
      "properties": {
        "type": {
          "const": "turn_terminated"
        },
        "turn_id": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier for the terminated turn"
        },
        "timestamp": {
          "type": "number",
          "description": "Unix timestamp when termination occurred"
        },
        "reason": {
          "type": "string",
          "enum": ["max_duration", "grace_period_exceeded"],
          "description": "Reason for termination"
        },
        "final_duration": {
          "type": "number",
          "minimum": 60,
          "description": "Final turn duration in seconds"
        }
      },
      "additionalProperties": false
    },

    "asr_connection_failed": {
      "type": "object",
      "description": "Sent when ASR connection fails and buffered audio is discarded",
      "required": ["type", "turn_id", "timestamp", "buffered_seconds", "action"],
      "properties": {
        "type": {
          "const": "asr_connection_failed"
        },
        "turn_id": {
          "type": "string",
          "format": "uuid",
          "description": "Turn identifier when failure occurred"
        },
        "timestamp": {
          "type": "number",
          "description": "Unix timestamp when failure was confirmed"
        },
        "buffered_seconds": {
          "type": "number",
          "minimum": 0,
          "maximum": 5,
          "description": "Amount of audio that was buffered and lost"
        },
        "action": {
          "type": "string",
          "enum": ["discarded", "reconnected"],
          "description": "What happened to the buffered audio"
        },
        "error_message": {
          "type": "string",
          "description": "Optional error details"
        }
      },
      "additionalProperties": false
    }
  },

  "oneOf": [
    { "$ref": "#/definitions/turn_warning" },
    { "$ref": "#/definitions/turn_terminated" },
    { "$ref": "#/definitions/asr_connection_failed" }
  ]
}
